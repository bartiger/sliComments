(function(c){window.addEvent("domready",function(){$$(".comments_form.no-js").removeClass("no-js");var d=c("comments_form_textarea"),e=c("comments-remaining-count"),a=c("comments_form"),f=a.get("data-logged")==1?true:false,h=new Form.Validator.Inline(a,{scrollToErrorsOnSubmit:false,evaluateFieldsOnChange:false,evaluateFieldsOnBlur:false}),g=function(){remaining_chars=500-this.value.length;e.set("text",remaining_chars);remaining_chars<=5?(e.setStyle("color","#900"),remaining_chars<0&&a.getElement("button").set("disabled",
true)):(a.getElement("button").set("disabled",false),e.setStyle("color",null))};d.addEvents({keypress:g,focus:function(){this.addClass("init")},blur:function(){this.value.length==0&&this.removeClass("init");g.call(this)}});"placeholder"in document.createElement("input")?d.get("disabled")||$$(".comments_form_inputs li label").setStyle("display","none"):(OverText.implement({attach:function(){var a=this.element,b=this.options,c=b.textOverride||a.get("placeholder")||a.get("alt")||a.get("title");if(!c)return this;
c=this.text=(a.getPrevious(b.element)||(new Element(b.element)).inject(a,"after")).addClass(b.labelClass).setStyles({lineHeight:"normal",position:"absolute",cursor:"text"}).set("html",c).addEvent("click",this.hide.pass(b.element=="label",this));b.element=="label"&&(a.get("id")||a.set("id","input_"+String.uniqueID()),c.set("for",a.get("id")));if(b.wrap)this.textHolder=(new Element("div.overTxtWrapper",{styles:{lineHeight:"normal",position:"relative"}})).grab(c).inject(a,"before");return this.enable()}}),
new OverText(d,{positionOptions:{offset:{x:6,y:6}}}),f||(new OverText(c("comments_form_name")),new OverText(c("comments_form_email"))));c("comments_form_send").addEvent("click",function(d){d.stop();h.validate()&&(new Request.JSON({url:a.get("action")+"&format=json",method:"post",data:"article_id="+a.article_id.value+(!f?"&name="+a.name.value+"&email="+a.email.value:"")+"&text="+a.text.value+"&"+a.getElement("input[type=hidden]").get("name")+"=1",onSuccess:function(b){if(b.success)b=b.data,(new Element("li.comment",
{html:'<div class="comment-body"><div class="profile-image-container"><img class="profile-image" src="//www.gravatar.com/avatar/'+b.email+'?s=40" alt="'+b.name+'"></div><div class="content-container"><div class="content"><div class="author">'+b.name+':</div><div class="comment-text">'+b.text+'</div></div></div></div><div class="clr"></div>'})).inject(c("comments_list"),a.get("data-position")),b=c("comments_counter"),b.set("text",b.get("text").toInt()+1),a.reset(),a.text.fireEvent("keypress"),a.text.removeClass("init"),
OverText.update()}})).send()})})})(document.id);