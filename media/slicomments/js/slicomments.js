(function(c){window.addEvent("domready",function(){$$(".comments_form.no-js").removeClass("no-js");var d=c("comments_form_textarea"),f=c("comments-remaining-count"),b=c("comments_form"),i=c("comments_list"),h=c("comments_counter"),g=b.get("data-logged")==1?true:false,k=new Form.Validator.Inline(b,{scrollToErrorsOnSubmit:false,evaluateFieldsOnChange:false,evaluateFieldsOnBlur:false}),j=function(){remaining_chars=this.get("data-maxlength")-this.value.length;f.set("text",remaining_chars);remaining_chars<=
5?(f.setStyle("color","#900"),remaining_chars<0&&b.getElement("button").set("disabled",true)):(b.getElement("button").set("disabled",false),f.setStyle("color",null))};d.addEvents({keypress:j,focus:function(){this.addClass("init")},blur:function(){this.value.length==0&&this.removeClass("init");j.call(this)}});"placeholder"in document.createElement("input")?d.get("disabled")||$$(".comments_form_inputs li label").setStyle("display","none"):(OverText.implement({attach:function(){var a=this.element,e=
this.options,b=e.textOverride||a.get("placeholder")||a.get("alt")||a.get("title");if(!b)return this;b=this.text=(a.getPrevious(e.element)||(new Element(e.element)).inject(a,"after")).addClass(e.labelClass).setStyles({lineHeight:"normal",position:"absolute",cursor:"text"}).set("html",b).addEvent("click",this.hide.pass(e.element=="label",this));e.element=="label"&&(a.get("id")||a.set("id","input_"+String.uniqueID()),b.set("for",a.get("id")));if(e.wrap)this.textHolder=(new Element("div.overTxtWrapper",
{styles:{lineHeight:"normal",position:"relative"}})).grab(b).inject(a,"before");return this.enable()}}),new OverText(d,{positionOptions:{offset:{x:6,y:6}}}),g||(new OverText(c("comments_form_name")),new OverText(c("comments_form_email"))));c("comments_form_send").addEvent("click",function(a){a.stop();k.validate()&&(new Request.JSON({url:b.get("action")+"&format=json",method:"post",data:b,onSuccess:function(a){if(a.success)a=a.data,(new Element("li.comment",{html:'<div class="comment-body"><div class="profile-image-container"><img class="profile-image" src="//www.gravatar.com/avatar/'+
a.email+'?s=40" alt="'+a.name+'"></div><div class="content-container"><div class="content"><div class="author">'+a.name+':</div><div class="comment-text">'+a.text+'</div></div></div></div><div class="clr"></div>'})).inject(i,b.get("data-position")),h.set("text",f.get("text").toInt()+1),b.reset(),b.text.fireEvent("keypress"),b.text.removeClass("init"),OverText.update()}})).send()});d=function(a){return function(b){b.stop();(new Request.JSON({url:this.get("href")+"&format=json",method:"get",onSuccess:a.bind(this)})).send()}};
g=function(a){if(a.success){var b=this.getParent(".content-container").getElement(".metadata"),b=b.getElement(".rating")||(new Element("span.rating")).inject(b),a=parseInt(b.get("text")||0,10)+a.delta;b.set("text",a>0?"+"+a:a).removeClass("(?:positive|negative)").addClass(a>0?"positive":"negative")}else alert(a.error)};i.addEvents({"click:relay(a.comment-delete)":d(function(a){a.success&&(this.getParent("li.comment").nix(true),h.set("text",h.get("text").toInt()-1))}),"click:relay(a.comment-like)":d(g),
"click:relay(a.comment-dislike)":d(g)})})})(document.id);