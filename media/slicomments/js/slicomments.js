(function(i){var k=new Class({o:{},initialize:function(d,h){this.textarea=i(d);this.counter=i(h);this.textarea.store("cC",this);this.o.m=d.get("data-maxlength")||500;var c=this.update_counter.bind(this);!Browser.chrome&&!Browser.safari&&this.textarea.addEvents({blur:c,change:c,focus:c,keydown:c,keypress:c,keyup:c,paste:c});this.textarea.addListener("input",c);c()},update_counter:function(){var d=this.o.m-this.textarea.value.length;
this.counter.set("text",d);5>=d?this.counter.setStyle("color","#900"):this.counter.setStyle("color",null);0>d?this.textarea.form.getElement("button").set("disabled",!0):this.textarea.form.getElement("button").set("disabled",!1)}});window.addEvent("domready",function(){var d=i("comments_section");d.removeClass("no-js");var h=i("comments_counter"),c=i("comments_list"),f=function(a){return function(b){b.stop();(new Request({url:this.get("href"),format:"raw",method:"get",onSuccess:a.bind(this),onFailure:function(a){alert(a.responseText)}})).send()}},
j=f(function(a){var b=this.getParent(".content-container").getElement(".metadata"),b=b.getElement(".rating")||(new Element("span.rating")).inject(b),a=(b.get("text").toInt()||0)+a.toInt();b.set("text",0<a?"+"+a:a).removeClass("(?:positive|negative)").addClass(0<a?"positive":"negative")});d.addEvents({"click:relay(.comment-delete)":f(function(){this.getParent("li.comment").nix(!0);h.set("text",h.get("text").toInt()-1)}),"click:relay(.comment-like)":j,"click:relay(.comment-dislike)":j,"click:relay(.slicomments-spoiler button)":function(){var a=
this.getParent();a.hasClass("spoiler-hide")?(a.removeClass("spoiler-hide"),this.set("text",this.get("data-hide"))):(a.addClass("spoiler-hide"),this.set("text",this.get("data-show")))},"click:relay(.cancel-reply)":function(a){a.stop();this.getParent(".comment").getElement(".comment-reply").getParent().setStyle("display",null);this.getParent("form").destroy()}});var g=d.getElement("form");if(g){f=g.getElement("textarea");new k(f,g.getElement(".chars-count"));var j=1==g.get("data-logged")?!0:!1,e=document.getElement("html").get("lang"),
e=e.split("-");e[1]=e[1].toUpperCase();e=e.join("-");Locale.list().contains(e)&&Locale.use(e);var l=function(a){var b=a.retrieve("validator");b||(b=new Form.Validator.Inline(a,{scrollToErrorsOnSubmit:!1,evaluateFieldsOnChange:!1,evaluateFieldsOnBlur:!1}),a.store("validator",b));return b.validate()};f.addEvents({focus:function(){this.addClass("init")},blur:function(){0==this.value.length&&this.removeClass("init")}});"placeholder"in document.createElement("input")?f.get("disabled")||$$(".comments_form_inputs li label").setStyle("display",
"none"):(OverText.implement({attach:function(){var a=this.element,b=this.options,c=b.textOverride||a.get("placeholder")||a.get("alt")||a.get("title");if(!c)return this;c=this.text=(a.getPrevious(b.element)||(new Element(b.element)).inject(a,"after")).addClass(b.labelClass).setStyles({lineHeight:"normal",position:"absolute",cursor:"text"}).set("html",c).addEvent("click",this.hide.pass("label"==b.element,this));"label"==b.element&&(a.get("id")||a.set("id","input_"+String.uniqueID()),c.set("for",a.get("id")));
if(b.wrap)this.textHolder=(new Element("div.overTxtWrapper",{styles:{lineHeight:"normal",position:"relative"}})).grab(c).inject(a,"before");return this.enable()}}),new OverText(f,{positionOptions:{offset:{x:6,y:6}}}),j||(new OverText(g.name),new OverText(g.email)));d.addEvent("click:relay(.comment-submit)",function(a){a.stop();l(this.form)&&(new Request.HTML({url:this.form.get("action"),format:"raw",method:"post",data:this.form,onSuccess:function(a){a[0].inject(c,this.form.get("data-position"));h.set("text",
h.get("text").toInt()+1);this.form.hasClass("reply-form")?this.form.destroy():(this.form.reset(),this.form.text.retrieve("cC").update_counter());OverText.update()}.bind(this),onFailure:function(a){alert(a.responseText)}})).send()});d.addEvent("click:relay(.comment-reply)",function(a){a.stop();a=g.clone();a.addClass("reply-form");a.getElements(".validation-advice").destroy();var b=this.getParent(".comment"),c=b.getElement(".metadata .author").get("text").trim();a.inject(b.getElement(".clr"),
"before");b=a.getElement("textarea").addClass("init");b.set("value","@"+c+" ").setCaretPosition("end");new k(b,a.getElement(".chars-count"));this.getParent().setStyle("display","none")})}})})(document.id);