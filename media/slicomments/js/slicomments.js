(function(h){var j=new Class({options:{},initialize:function(d,g){this.textarea=h(d);this.counter=h(g);this.textarea.store("cC",this);this.options.maxLength=d.get("data-maxlength")||500;var c=this.update_counter.bind(this);!Browser.chrome&&!Browser.safari&&this.textarea.addEvents({blur:c,change:c,focus:c,keydown:c,keypress:c,keyup:c,paste:c});this.textarea.addListener("input",c);c()},update_counter:function(){var d=this.options.maxLength-this.textarea.value.length;
this.counter.set("text",d);d<=5?this.counter.setStyle("color","#900"):this.counter.setStyle("color",null);d<0?this.textarea.form.getElement("button").set("disabled",true):this.textarea.form.getElement("button").set("disabled",false)}});window.addEvent("domready",function(){var d=h("comments_section");d.removeClass("no-js");var g=h("comments_counter"),c=h("comments_list"),e=function(a){return function(b){b.stop();(new Request({url:this.get("href"),format:"raw",method:"get",onSuccess:a.bind(this),onFailure:function(a){alert(a.responseText)}})).send()}},
i=e(function(a){var b=this.getParent(".content-container").getElement(".metadata"),b=b.getElement(".rating")||(new Element("span.rating")).inject(b),a=(b.get("text").toInt()||0)+a.toInt();b.set("text",a>0?"+"+a:a).removeClass("(?:positive|negative)").addClass(a>0?"positive":"negative")});c.addEvents({"click:relay(.comment-delete)":e(function(){this.getParent("li.comment").nix(true);g.set("text",g.get("text").toInt()-1)}),"click:relay(.comment-like)":i,"click:relay(.comment-dislike)":i,"click:relay(.slicomments-spoiler button)":function(){var a=
this.getParent();a.hasClass("spoiler-hide")?(a.removeClass("spoiler-hide"),this.set("text",this.get("data-hide"))):(a.addClass("spoiler-hide"),this.set("text",this.get("data-show")))}});var f=d.getElement("form");if(f){e=f.getElement("textarea");new j(e,f.getElement(".chars-count"));var i=f.get("data-logged")==1?true:false,k=function(a){var b=a.retrieve("validator");b||(b=new Form.Validator.Inline(a,{scrollToErrorsOnSubmit:false,evaluateFieldsOnChange:false,evaluateFieldsOnBlur:false}),a.store("validator",
b));return b.validate()};e.addEvents({focus:function(){this.addClass("init")},blur:function(){this.value.length==0&&this.removeClass("init")}});"placeholder"in document.createElement("input")?e.get("disabled")||$$(".comments_form_inputs li label").setStyle("display","none"):(OverText.implement({attach:function(){var a=this.element,b=this.options,c=b.textOverride||a.get("placeholder")||a.get("alt")||a.get("title");if(!c)return this;c=this.text=(a.getPrevious(b.element)||(new Element(b.element)).inject(a,
"after")).addClass(b.labelClass).setStyles({lineHeight:"normal",position:"absolute",cursor:"text"}).set("html",c).addEvent("click",this.hide.pass(b.element=="label",this));b.element=="label"&&(a.get("id")||a.set("id","input_"+String.uniqueID()),c.set("for",a.get("id")));if(b.wrap)this.textHolder=(new Element("div.overTxtWrapper",{styles:{lineHeight:"normal",position:"relative"}})).grab(c).inject(a,"before");return this.enable()}}),new OverText(e,{positionOptions:{offset:{x:6,y:6}}}),i||(new OverText(f.name),
new OverText(f.email)));d.addEvent("click:relay(.comment-submit)",function(a){a.stop();k(this.form)&&(new Request.HTML({url:this.form.get("action"),format:"raw",method:"post",data:this.form,onSuccess:function(a){a[0].inject(c,this.form.get("data-position"));g.set("text",g.get("text").toInt()+1);this.form.hasClass("reply-form")?this.form.destroy():(this.form.reset(),this.form.text.retrieve("cC").update_counter());OverText.update()}.bind(this),onFailure:function(a){alert(a.responseText)}})).send()});
c.addEvent("click:relay(.comment-reply)",function(a){a.stop();a=f.clone();a.addClass("reply-form");a.getElements(".validation-advice").destroy();var b=this.getParent(".comment"),c=b.getElement(".metadata .author").get("text").trim();a.inject(b.getElement(".clr"),"before");b=a.getElement("textarea").addClass("init");b.set("value","@"+c+" ").setCaretPosition("end");new j(b,a.getElement(".chars-count"));this.getParent().destroy()})}})})(document.id);